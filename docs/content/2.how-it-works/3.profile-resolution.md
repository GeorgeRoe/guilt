---
title: Profile Resolution Policy
description: Understanding how GUILT decides which CPU Profile to use
navigation:
  icon: i-lucide-file-code-corner
---

The Profile Resolution Policy (PRP) is a script that defines a set of rules that GUILT uses to deduce which CPU Profile to use when estimating the energy consumption of an unprocessed job.

## Default PRP

GUILT contains default PRPs for well known supercomputers, which are automatically placed into your GUILT directory upon installation.

Currently these scripts exist for the following supercomputers:

- SCARF

*If your supercomputer does not appear here and you make a custom script for it, please consider contributing your script to the GUILT repository so that other users on the same supercomputer can benefit from it.*

## Creating a PRP

PRP scripts are written in the Rhai scripting language, which is a simple and efficient scripting language designed for embedding in Rust applications.
You can learn more about Rhai and its sytax [here](https://rhai.rs/).

To create a PRP script you must create a file named `profile_resolution_policy.rhai` in the `~/.guilt/` directory.
The PRP script must define a function named `identify_cpu` that takes two parameters:

- `partition` - The partition on which the job was run.
- `nodes` - A list of node objects representing the nodes on which the job was run.

Below is an example of a PRP script built for the SCARF super computer:

```rhai [~/.guilt/profile_resolution_policy.rhai]
// This function checks if all nodes in the list have a specific feature
fn all_nodes_have_feature(nodes, feature) {
  for node in nodes {
    if !node.features.contains(feature) {
      return false;
    }
  }

  true
}

fn identify_cpu(partition, nodes) {
  if partition == "gpu" {
    "AMD Epyc 7302"
  } else {
    if all_nodes_have_feature(nodes, "scarf24") {
      "AMD Epyc 9654"
    } else {
      "AMD Epyc 7502"
    }
  }
}
```

There are several fields on `Node` that you can access:

::field-group
::field{name="architecture" type="string" required}
The architecture of the CPU on the node.
::

::field{name="cores" type="integer" required}
The number of CPU cores available on the node.
::

::field{name="cpus" type="integer" required}
The number of CPUs available on the node.
::

::field{name="features" type="List<string>" required}
A list of features available on the node.
::

::field{name="name" type="string" required}
The name of the node.
::

::field{name="operating_system" type="string" required}
The operating system running on the node.
::

::field{name="partitions" type="List<string>" required}
A list of partitions that the node belongs to.
::

::field{name="memory" type="integer" required}
The amount of memory available on the node in bytes.
::

::field{name="sockets" type="integer" required}
The number of CPU sockets available on the node.
::

::field{name="threads" type="integer" required}
The number of CPU threads available on the node.
::
::
